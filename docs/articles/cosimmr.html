<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stable Isotope Mixing Models with Covariates in R using cosimmr • cosimmr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Stable Isotope Mixing Models with Covariates in R using cosimmr">
<meta property="og:description" content="cosimmr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cosimmr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/cosimmr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Stable Isotope Mixing Models with Covariates in
R using cosimmr</h1>
                        <h4 data-toc-skip class="author">Emma Govan and
Andrew Parnell</h4>
            
            <h4 data-toc-skip class="date">2024-05-30</h4>
      
      
      <div class="hidden name"><code>cosimmr.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>cosimmr</code> is a package in R designed for running Stable
Isotope Mixing Models in R, using Fixed Form Variational Bayes. The aim
of this vignette is to allow users to quickly learn how to use the
package and giving examples of all the features within the package. If
you find any bugs in the software, or have new features which you think
would be useful, please add this to the <a href="https://github.com/emmagovan/cosimmr/issues" class="external-link">Github issues
page</a></p>
</div>
<div class="section level2">
<h2 id="installation-of-the-cosimmr-package">Installation of the <code>cosimmr</code> package<a class="anchor" aria-label="anchor" href="#installation-of-the-cosimmr-package"></a>
</h2>
<p>First, start Rstudio and find the window with the command prompt (the
symbol <code>&gt;</code>). Type</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"cosimmr"</span><span class="op">)</span></span></code></pre></div>
<p>It may ask you to pick your nearest CRAN mirror (the nearest site
which hosts R packages). You will then see some activity on the screen
as the <code>cosimmr</code> package and the other packages it uses are
downloaded. The final line should then read:</p>
<p><code>package 'cosimmr' successfully unpacked and MD5 sums checked</code></p>
<p>You then need to load the package. Type</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">cosimmr</span><span class="op">)</span></span></code></pre></div>
<p>This will load the <code>cosimmr</code> package and all the
associated packages. You’ll need to type the
<code><a href="https://rdrr.io/r/base/library.html" class="external-link">library(cosimmr)</a></code> command every time you start R.</p>
<p>There is some sample data sets (from ADD PAPER REF) available within
cosimmr. Use the following command to access one.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">geese_data_day1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in data(geese_data_day1): data set 'geese_data_day1' not found</span></span></code></pre>
<p>This data can then be loaded into cosimmr using the function
<code>cosimmr_load</code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cosimmr_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span></span>
<span>  <span class="va">geese_data_day1</span>,</span>
<span>  <span class="fu"><a href="../reference/cosimmr_load.html">cosimmr_load</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">mixtures</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    source_names <span class="op">=</span> <span class="va">source_names</span>,</span>
<span>    source_means <span class="op">=</span> <span class="va">source_means</span>,</span>
<span>    source_sds <span class="op">=</span> <span class="va">source_sds</span>,</span>
<span>    correction_means <span class="op">=</span> <span class="va">correction_means</span>,</span>
<span>    correction_sds <span class="op">=</span> <span class="va">correction_sds</span>,</span>
<span>    concentration_means <span class="op">=</span> <span class="va">concentration_means</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Cannot scale when using mixtures ~1</span></span></code></pre>
<p>This is a simple example that doesn’t include any covariates. Note
the formula is given in the form
<code>tracer_data ~ covariates</code>.</p>
<p>An isospace plot can be generated using this data</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cosimmr_1</span><span class="op">)</span></span></code></pre></div>
<p><img src="cosimmr_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>The data can then be run through <code>cosimmr_ffvb</code>, the main
function of the <code>cosimmr</code> package.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cosimmr_1_out</span> <span class="op">=</span> <span class="fu"><a href="../reference/cosimmr_ffvb.html">cosimmr_ffvb</a></span><span class="op">(</span><span class="va">cosimmr_1</span><span class="op">)</span></span></code></pre></div>
<p>Summary statistics for the run can then be viewed, several options
are available, such as “statistics” and “quantiles”</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cosimmr_1_out</span>, type <span class="op">=</span> <span class="st">"statistics"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Summary for Observation 1</span></span></code></pre>
<pre><code><span><span class="co">##                  mean    sd</span></span>
<span><span class="co">## P(Zostera)      0.492 0.175</span></span>
<span><span class="co">## P(Grass)        0.073 0.021</span></span>
<span><span class="co">## P(U.lactuca)    0.241 0.134</span></span>
<span><span class="co">## P(Enteromorpha) 0.193 0.131</span></span>
<span><span class="co">## sd_d13C_Pl      1.071 0.792</span></span>
<span><span class="co">## sd_d15N_Pl      0.806 0.649</span></span></code></pre>
<p>The output of this can be plotted, using the plot function. There are
several different options available in the plot function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cosimmr_1_out</span>, type <span class="op">=</span><span class="st">"prop_histogram"</span>, obs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="cosimmr_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>For another example, with a continuous covariate, we can look at
Alligator data from Nifong et al, 2015. For this example we just use
Length as the covariate - but the dataset contains other covariates that
can be looked at too. First we load in the data into R - this data is
included in cosimmr:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"alligator_data"</span><span class="op">)</span></span></code></pre></div>
<p>Then we use <code>cosimmr_load</code> to create a “cosimmr_in”
object</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Length</span> <span class="op">=</span> <span class="va">alligator_data</span><span class="op">$</span><span class="va">length</span></span>
<span><span class="va">cosimmr_ali</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/cosimmr_load.html">cosimmr_load</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">alligator_data</span><span class="op">$</span><span class="va">mixtures</span><span class="op">)</span> <span class="op">~</span> <span class="va">Length</span>,</span>
<span>    source_names <span class="op">=</span> <span class="va">alligator_data</span><span class="op">$</span><span class="va">source_names</span>,</span>
<span>    source_means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">alligator_data</span><span class="op">$</span><span class="va">source_means</span><span class="op">)</span>,</span>
<span>    source_sds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">alligator_data</span><span class="op">$</span><span class="va">source_sds</span><span class="op">)</span>,</span>
<span>    correction_means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">alligator_data</span><span class="op">$</span><span class="va">TEF_means</span><span class="op">)</span>,</span>
<span>    correction_sds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">alligator_data</span><span class="op">$</span><span class="va">TEF_sds</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We then plot our data to make sure our iso-space plot looks good</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cosimmr_ali</span>, colour_by_cov <span class="op">=</span> <span class="cn">TRUE</span>, cov_name <span class="op">=</span> <span class="st">"Length"</span><span class="op">)</span></span></code></pre></div>
<p>Then we can run the mixing model:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cosimmr_ali_out</span> <span class="op">=</span> <span class="fu"><a href="../reference/cosimmr_ffvb.html">cosimmr_ffvb</a></span><span class="op">(</span><span class="va">cosimmr_ali</span><span class="op">)</span></span></code></pre></div>
<p>We can then look at a summary of the data. This defaults to
individual 1</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cosimmr_ali_out</span>, type <span class="op">=</span> <span class="st">"statistics"</span><span class="op">)</span></span></code></pre></div>
<p>We can create plots of our data. This code creates a proportion plot
and a histogram plot of beta value for individuals 1 and 2</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cosimmr_ali_out</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prop_histogram"</span>, <span class="st">"beta_histogram"</span><span class="op">)</span>, obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, cov_name <span class="op">=</span> <span class="st">"Length"</span><span class="op">)</span></span></code></pre></div>
<p>We can use the predict function to predict proportions for
individuals of lengths 100, 210, and 203 by creating a data frame and
then using the <code>predict</code> function</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">210</span>,<span class="fl">302</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">alli_pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">cosimmr_ali_out</span>, <span class="va">x_pred</span><span class="op">)</span></span></code></pre></div>
<p>“alli_pred” can be treated like a normal cosimmr_out object - we can
get summary values for each individual or we can create plots</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">alli_pred</span>, obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"statistics"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">alli_pred</span>, type <span class="op">=</span> <span class="st">"prop_density"</span><span class="op">)</span></span></code></pre></div>
<p>We can create a <code>covariates_plot</code> to show the change in
consumption of Freshwater as an individual increases in Length</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cosimmr_ali_out</span>, type <span class="op">=</span> <span class="st">"covariates_plot"</span>, source <span class="op">=</span> <span class="st">"Freshwater"</span>, cov_name <span class="op">=</span> <span class="st">"Length"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively we can look at the change in both sources on one
plot</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cosimmr_ali_out</span>, type <span class="op">=</span> <span class="st">"covariates_plot"</span>, cov_name <span class="op">=</span> <span class="st">"Length"</span>, one_plot <span class="op">=</span> <span class="cn">TRUE</span>, n_pred <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Emma Govan, Andrew Parnell.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
